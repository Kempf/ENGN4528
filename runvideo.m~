close all
clear all
clc

if ismac
    video = VideoReader('Angry Birds In-game Trailer-quicktime.mov');
    % Need this for me(Jae) to work on Macbook
    % Mac cannot read avi video
else
    video = VideoReader('Angry Birds In-game Trailer.avi');
end


video.CurrentTime = 36;
toc_0 = 0;
tic
frame_count = 1;

[eigb_red,img_ave_red] = find_eigbird_red(15);


win_size = [19,21];



while hasFrame(video)
    if video.CurrentTime >= 40
        video.CurrentTime = 37;
    end
    
    
    frame = readFrame(video);
%     subplot(1,2,1)
    %%
    frame(:,:,1) = mefilt2()
    image(frame)
    
    
    frame_red_bird = CropColour(frame,[180,220,0,30,30,70]);
    [frame_red_bird,region_r] = Filter(frame_red_bird);
    
    
    frame_black_bird = CropColour(frame,[0,20,0,20,0,20]);
    [frame_black_bird,region_k] = Filter_Black(frame_black_bird);
%     subplot(1,2,2)
%     image(frame_black_bird*1000)
    %%
    [centres,radii] = imfindcircles(frame,[5,15],'Sensitivity',0.958,'EdgeThreshold',0.3);
    viscircles(centres, radii,'EdgeColor','b');
    
    
    
    
    
    %% PCA part
    % for i = 1:size(region)
    %     rec = region(i).BoundingBox;
    %     bird_found = 0;
    %     for w = win_size
    %
    %         x_list =round(rec(1)+floor(w/2):5:rec(1)+rec(3)-floor(w/2));
    %         y_list =round(rec(2)+floor(w/2):5:rec(2)+rec(4)-floor(w/2));
    %
    %         for y = y_list
    %             for x = x_list
    %
    % %                 x
    % %                 y
    %                 frame_w = frame(y-floor(w/2):y+floor(w/2),...
    %                     x-floor(w/2):x+floor(w/2),:);
    % %                 subplot(1,2,2)
    % %                 image(frame_w)
    % %                 pause(0.5)
    %                 dist = CalcDist_Red(frame_w,img_ave_red,eigb_red);
    %
    %                 if dist <= 1.4
    %                     bird_found = 1;
    %                     rec_bird = rectangle('Position',[x-floor(w/2),y-floor(w/2),w,w]);
    %                     break
    %                 end
    %
    %             end
    %             if bird_found
    %                 break
    %             end
    %         end
    %         if bird_found
    %             break
    %         end
    %
    %     end
    % end
    %%
    
    if frame_count == 10
        clc
        frame_count = 1;
        toc_1 = toc;
        time_per_frame = (toc_1 - toc_0)/10;
        frame_per_sec = 1/time_per_frame
        toc_0 = toc_1;
    end
    
    frame_count = frame_count + 1;
    drawnow
end
